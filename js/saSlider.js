;(function($){"use strict";var defaults,debounce,pluginName='saSlider',DOM={window:$(window),document:$(document)},raf=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(cb){return window.setTimeout(cb,1000/60);},defaults={loop:true,indicators:true,keys:{prev:'37, 80',next:'39, 78'}};function SaSlider(sliderElm,settings){this.slider=$(sliderElm);this.slides=this.slider.find('> ul > li');this.settings=$.extend({},defaults,settings||{});this.active=this.slider.find('.active');this.index=0;if(!this.settings.loop)this.markEdges();this.checkOrientation.call(this);this.bind();}SaSlider.prototype={bind:function(){var that=this;this.slider.on('click','> .arrow',this.events.btn.bind(this));this.slider.find('> ul').on('transitionend','> li',this.events.transitionEnd.bind(this));DOM.document.on('keydown.'+pluginName,this.events.keyDown.bind(this));if(this.settings.indicators){this.indicators.generate.apply(this);this.indicators.elm.on('click','i',function(){that.changeSlide($(this).index());});}DOM.window.on('resize.'+pluginName,function(){Date.now()%2==0&&that.checkOrientation.call(that);});this.slider.on('dragstart',function(event){event.preventDefault();});this.slider.on('swipe',this.events.move.bind(this));this.slider.on('mouseup touchend',this.events.cancelDragging.bind(this));},events:{drag:{offset:0,dirtySlides:$(),dragSibling:null},btn:function(e){var idx=e.currentTarget.classList[1]=='next'?this.index+1:this.index-1;this.changeSlide(idx);},keyDown:function(e){var idx=this.settings.keys.next.indexOf(e.keyCode)?this.index-1:this.index+1;return this.settings.keys.next.indexOf(e.keyCode)>=0&&this.changeSlide(idx)||this.settings.keys.prev.indexOf(e.keyCode)>=0&&this.changeSlide(idx)||true;},transitionEnd:function(e){this.events.drag.dirtySlides=$();this.slides.each(function(){this.removeAttribute('style');})},move:function(e,Dx,Dy){var that=this,percent=(Dx/this.slider[0].clientWidth)*100,idx=Dx>0?this.index+1:this.index-1;this.events.drag.offset=percent;percent=Math.abs(percent);if(idx>this.slides.length-1)idx=0;else if(idx<0)idx=this.slides.length-1;this.events.drag.dragSibling=this.slides.eq(idx);this.events.drag.dirtySlides=this.events.drag.dirtySlides.add(this.events.drag.dragSibling[0]);that.slider.toggleClass('prevSlide',Dx>0);raf(function(){that.slider.addClass('dragging');if(that.events.drag.dragSibling)that.events.drag.dragSibling[0].style.width=percent+'%';that.active[0].style.width=100-percent+'%';that.events.drag.dirtySlides.not(that.events.drag.dragSibling).removeAttr('style');});},cancelDragging:function(e){var pointOfChange=22;this.slider.removeClass('dragging');this.events.drag.dragSibling&&this.events.drag.dragSibling.removeClass('active').removeAttr('style');this.active.removeAttr('style');if(this.events.drag.offset<-pointOfChange){this.changeSlide(this.index-1,true);}else if(this.events.drag.offset>pointOfChange){this.changeSlide(this.index+1,true);}this.events.drag.offset=0;this.events.drag.dragSibling=null;}},changeSlide:function(idx,force){var isAnimating=this.active.width()<this.slider[0].clientWidth,newActive=this.slides.eq(idx),floatItem;if(!force&&isAnimating||(!this.settings.loop&&!newActive.length))return;this.slider.toggleClass('prevSlide',idx<this.index);if(idx>this.slides.length-1)idx=0;else if(idx<0)idx=this.slides.length-1;newActive=this.slides.eq(idx);this.checkOrientation.call(this,newActive);this.active.css('width',0).removeClass('active');this.active=newActive.addClass('active');if(!this.settings.loop)this.markEdges();this.index=idx;if(this.settings.indicators)this.indicators.mark.apply(this);},checkOrientation:(function(){var timer;return function($slide){$slide=$slide||this.active;var that=this,img,imgRatio,sliderRatio,isPortrait;clearTimeout(timer);timer=setTimeout(function(){img=$slide.find('> img')[0];if(img.clientWidth==0||img.clientHeight==0){that.checkOrientation.call(that,$slide);return;}imgRatio=img.naturalWidth/img.naturalHeight;sliderRatio=that.slider[0].clientWidth/that.slider[0].clientHeight;isPortrait=imgRatio>sliderRatio;$slide.toggleClass('portrait',isPortrait);},20);}})(),markEdges:function(){this.slider.toggleClass('start',!this.active.prev().length).toggleClass('end',!this.active.next().length);},indicators:{generate:function(){var htmlString='<div class="indicators"><div class="wrap">'+Array(this.slides.length+1).join('<i></i>')+'<b></b></div></div>';this.slider.append(htmlString);this.indicators.elm=this.slider.find('.indicators');this.indicators.marker=this.indicators.elm.find('b');return this;},mark:function(){var pos=this.indicators.marker.outerWidth(true)*this.index;this.indicators.marker.css('left',pos);return this;}}}
$.fn[pluginName]=function(settings){return this.each(function(){var saSlider=$(this).data('_'+pluginName);if(saSlider)return this;$(this).data('_'+pluginName,new SaSlider(this,settings));});};})(jQuery);